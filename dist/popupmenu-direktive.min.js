angular.module("tpl.popupmenu",[]).directive("popupmenu",["$timeout",function(a){"use strict";var b={offsetHorizontal:30,width:200,placement:"none",toggle:"hover",closeTimeout:300},c="popupMenuTimeout",d=$('<div class="popupmenu__triangle" />'),e=function(a){a.offsetHorizontal=a.offsetHorizontal||0,a.offsetVertical=a.offsetVertical||0;var b=parseInt(a.offsetHorizontal,10),c=parseInt(a.offsetVertical,10),d=parseInt(a.width,10),e={left:-d/2+"px","margin-left":b+"px"},f={bottom:c+"px"},g={top:c+"px"};switch(d&&(e.width=d+"px"),a.placement){case"none":return{};case"s":case"sw":case"se":return angular.extend({},f,e);case"n":case"nw":case"ne":return angular.extend({},g,e)}return e},f=function(a,b,c){"block"!==a.css("display")?g(a,b):h(a,c.closeTimeout)},g=function(b,d){b.data(c)&&a.cancel(b.data(c)),b.css("display","block").css(d)},h=function(b,d){b.data(c,a(function(){b.css({display:"none"})},d))};return{restrict:"E",transclude:!0,template:'<div class="popupmenu" ng-transclude></div>',link:function(a,c,i){var j=$(".popupmenu__content:first",c);if(i=angular.extend(b,i),i.triangle&&i.placement&&"none"!==i.placement){var k=d.clone();k.addClass("popupmenu__triangle--"+i.placement),j.append(k)}var l=e(i,$(".popupmenu__trigger",c));("hover"===i.toggle||"both"===i.toggle)&&(c.on("mouseover",function(){g(j,l)}),c.on("mouseleave",function(){h(j,i.closeTimeout)}),j.on("mouseleave",function(){h(j,i.closeTimeout)}),j.on("mouseover",function(){g(j,l)})),("click"===i.toggle||"both"===i.toggle)&&c.on("click",function(){f(j,l,i)})}}}]);