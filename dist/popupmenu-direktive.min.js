angular.module("tpl.popupmenu",[]).directive("popupmenu",["$timeout","$window",function(a,b){"use strict";var c=b.document.createElement("div");c.className="popupmenu__triangle";var d={offsetHorizontal:30,width:200,placement:"none",toggle:"hover",closeTimeout:300},e="popupMenuTimeout",f=function(a){a.offsetHorizontal=a.offsetHorizontal||0,a.offsetVertical=a.offsetVertical||0;var b=parseInt(a.offsetHorizontal,10),c=parseInt(a.offsetVertical,10),d=parseInt(a.width,10),e={left:-d/2+"px","margin-left":b+"px"},f={bottom:c+"px"},g={top:c+"px"};switch(d&&(e.width=d+"px"),a.placement){case"none":return{};case"s":case"sw":case"se":return angular.extend({},f,e);case"n":case"nw":case"ne":return angular.extend({},g,e)}return e},g=function(a,c,d){"block"!==b.getComputedStyle(a[0],null).getPropertyValue("display")?h(a,c):i(a,d.closeTimeout)},h=function(b,c){b[0].getAttribute("data-"+e)&&a.cancel(b[0].getAttribute("data-"+e));for(var d in c)b[0].style[d]=c[d];b[0].style.display="block"},i=function(b,c){b[0].setAttribute("data-"+e,a(function(){b[0].style.display="none"},c))};return{restrict:"E",transclude:!0,template:'<div class="popupmenu" ng-transclude></div>',link:function(a,b,e){var j=angular.element(b[0].getElementsByClassName("popupmenu__content"));if(e=angular.extend({},d,e),e.triangle&&e.placement&&"none"!==e.placement){var k=c.clone();k.addClass("popupmenu__triangle--"+e.placement),j.append(k)}var l=f(e,b[0].getElementsByClassName("popupmenu__trigger"));("hover"===e.toggle||"both"===e.toggle)&&(b.on("mouseover",function(){h(j,l)}),j.on("mouseover",function(){h(j,l)})),("click"===e.toggle||"both"===e.toggle)&&b.on("click",function(){g(j,l,e)}),j.on("mouseleave",function(){i(j,e.closeTimeout)}),b.on("mouseleave",function(){i(j,l)})}}}]);